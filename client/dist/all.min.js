var app=angular.module("mainApp",["templates"]);app.controller("MainCtrl",["$scope","auth","$location",function(o,e){o.user={},o.register=function(){e.register(o.user).error(function(e){o.error=e}).then(function(){window.location="http://localhost:3000/user/#/home"}),mixpanel.track("User Register",{area:"home",page:"home",action:"register"})},o.logIn=function(){e.logIn(o.login).error(function(e){o.error=e}).then(function(){window.location="http://localhost:3000/user/#/home"}),mixpanel.track("User Log-in",{area:"home",page:"home",action:"log-in"})},o.forgotPassword=function(){e.forgotPassword(o.forgot).success(function(e){o.forgot={},o.success=!0,console.log(e.message)}).error(function(e){o.error=e}),mixpanel.track("User Reset Password",{area:"home",page:"home",action:"resetPassword"})},o.isLoggedIn=e.isLoggedIn,o.currentUser=e.currentUser,o.logOut=e.logOut}]),app.factory("auth",["$http","$window",function(o,e){var n={};return n.saveToken=function(o){e.localStorage["admin-token"]=o},n.getToken=function(){return e.localStorage["admin-token"]},n.isLoggedIn=function(){var o=n.getToken();if(o){var r=JSON.parse(e.atob(o.split(".")[1]));return r.exp>Date.now()/1e3}return!1},n.currentUser=function(){if(n.isLoggedIn()){var o=n.getToken(),r=JSON.parse(e.atob(o.split(".")[1]));return r.username}},n.register=function(e){return o.post("/api/register",e).success(function(o){n.saveToken(o.token)})},n.logIn=function(e){return o.post("/api/login",e).success(function(o){n.saveToken(o.token)})},n.logOut=function(){e.localStorage.removeItem("admin-token")},n.forgotPassword=function(e){return o.post("/api/forgot",e)},n}]);