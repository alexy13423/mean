var app=angular.module("mainApp",["templates"]);app.controller("MainCtrl",["$scope","auth",function(e,n){e.user={},e.register=function(){n.register(e.user).error(function(n){e.error=n}).then(function(){})},e.logIn=function(){n.logIn(e.user).error(function(n){e.error=n}).then(function(){})},e.isLoggedIn=n.isLoggedIn,e.currentUser=n.currentUser,e.logOut=n.logOut}]),app.factory("auth",["$http","$window",function(e,n){var r={};return r.saveToken=function(e){n.localStorage["flapper-news-token"]=e},r.getToken=function(){return n.localStorage["flapper-news-token"]},r.isLoggedIn=function(){var e=r.getToken();if(e){var t=JSON.parse(n.atob(e.split(".")[1]));return t.exp>Date.now()/1e3}return!1},r.currentUser=function(){if(r.isLoggedIn()){var e=r.getToken(),t=JSON.parse(n.atob(e.split(".")[1]));return t.username}},r.register=function(n){return e.post("/register",n).success(function(e){r.saveToken(e.token)})},r.logIn=function(n){return e.post("/login",n).success(function(e){r.saveToken(e.token)})},r.logOut=function(){n.localStorage.removeItem("flapper-news-token")},r}]);