var app=angular.module("mainApp",["templates"]);app.controller("MainCtrl",["$scope","auth","$location",function(n,e,o){n.user={},n.register=function(){e.register(n.user).error(function(e){n.error=e}).then(function(){window.location="http://localhost:3000/user/#/home"})},n.logIn=function(){e.logIn(n.login).error(function(e){n.error=e}).then(function(){window.location="http://localhost:3000/user/#/home"})},n.isLoggedIn=e.isLoggedIn,n.currentUser=e.currentUser,n.logOut=e.logOut}]),app.factory("auth",["$http","$window",function(n,e){var o={};return o.saveToken=function(n){e.localStorage["flapper-news-token"]=n},o.getToken=function(){return e.localStorage["flapper-news-token"]},o.isLoggedIn=function(){var n=o.getToken();if(n){var t=JSON.parse(e.atob(n.split(".")[1]));return t.exp>Date.now()/1e3}return!1},o.currentUser=function(){if(o.isLoggedIn()){var n=o.getToken(),t=JSON.parse(e.atob(n.split(".")[1]));return t.username}},o.register=function(e){return n.post("/register",e).success(function(n){o.saveToken(n.token)})},o.logIn=function(e){return n.post("/login",e).success(function(n){o.saveToken(n.token)})},o.logOut=function(){e.localStorage.removeItem("flapper-news-token")},o}]);