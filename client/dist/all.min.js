var app=angular.module("mainApp",["templates"]);app.controller("MainCtrl",["$scope","auth","$location",function(o,n){o.user={},o.register=function(){n.register(o.user).error(function(n){o.error=n}).then(function(){window.location="http://localhost:3000/user/#/home"})},o.logIn=function(){n.logIn(o.login).error(function(n){o.error=n}).then(function(){window.location="http://localhost:3000/user/#/home"})},o.forgotPassword=function(){n.forgotPassword(o.forgot).error(function(n){console.log(o.forgot),o.error=n})},o.isLoggedIn=n.isLoggedIn,o.currentUser=n.currentUser,o.logOut=n.logOut}]),app.factory("auth",["$http","$window",function(o,n){var t={};return t.saveToken=function(o){n.localStorage["admin-token"]=o},t.getToken=function(){return n.localStorage["admin-token"]},t.isLoggedIn=function(){var o=t.getToken();if(o){var r=JSON.parse(n.atob(o.split(".")[1]));return r.exp>Date.now()/1e3}return!1},t.isGroupMember=function(){var o=t.getToken();if(o){var r=JSON.parse(n.atob(o.split(".")[1]));return r.group_id=this.group_id}return!1},t.currentUser=function(){if(t.isLoggedIn()){var o=t.getToken(),r=JSON.parse(n.atob(o.split(".")[1]));return r.username}},t.register=function(n){return o.post("/api/register",n).success(function(o){t.saveToken(o.token)})},t.logIn=function(n){return o.post("/api/login",n).success(function(o){t.saveToken(o.token)})},t.logOut=function(){n.localStorage.removeItem("admin-token")},t.forgotPassword=function(n){return o.post("/api/forgot",n).success(function(o){t.saveToken(o.token),$scope.success=!0})},t}]);