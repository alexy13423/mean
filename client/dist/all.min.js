var app=angular.module("mainApp",["templates"]);app.controller("MainCtrl",["$scope","auth","$location",function(e,o){e.user={},e.facebookService={},e.register=function(){o.register(e.user).error(function(o){e.error=o}).then(function(){window.location="http://localhost:3000/user/#/home"}),mixpanel.track("User Register",{area:"home",page:"home",action:"register"})},e.logIn=function(){o.logIn(e.login).error(function(o){e.error=o}).then(function(){window.location="http://localhost:3000/user/#/home"}),mixpanel.track("User Log-in",{area:"home",page:"home",action:"log-in"})},e.forgotPassword=function(){o.forgotPassword(e.forgot).success(function(o){e.forgot={},e.success=!0,console.log(o.message)}).error(function(o){e.error=o}),mixpanel.track("User Reset Password",{area:"home",page:"home",action:"resetPassword"})},e.isLoggedIn=o.isLoggedIn,e.currentUser=o.currentUser,e.logOut=o.logOut}]),app.factory("auth",["$http","$window",function(e,o){var r={};return r.saveToken=function(e){o.localStorage["admin-token"]=e},r.getToken=function(){return o.localStorage["admin-token"]},r.isLoggedIn=function(){var e=r.getToken();if(e){var n=JSON.parse(o.atob(e.split(".")[1]));return n.exp>Date.now()/1e3}return!1},r.currentUser=function(){if(r.isLoggedIn()){var e=r.getToken(),n=JSON.parse(o.atob(e.split(".")[1]));return n.username}},r.register=function(o){return e.post("/api/register",o).success(function(e){r.saveToken(e.token)})},r.logIn=function(o){return e.post("/api/login",o).success(function(e){r.saveToken(e.token)})},r.logOut=function(){o.localStorage.removeItem("admin-token")},r.forgotPassword=function(o){return e.post("/api/forgot",o)},r}]),app.factory("facebookService",["$q",function(e){facebookServce.getMyLastName=function(){var o=e.defer();return FB.api("/me",{fields:"last_name"},function(e){!e||e.error?o.reject("Error occured"):o.resolve(e)}),o.promise},facebookServce.getMyFirstName=function(){var o=e.defer();return FB.api("/me",{fields:"first_name"},function(e){!e||e.error?o.reject("Error occured"):o.resolve(e)}),o.promise},facebookServce.getMyEmail=function(){var o=e.defer();return FB.api("/me",{fields:"email"},function(e){!e||e.error?o.reject("Error occured"):o.resolve(e)}),o.promise}}]);