var app=angular.module("mainApp",["templates"]);app.controller("MainCtrl",["$scope","auth","$location",function(e,n,o){e.user={},e.register=function(){n.register(e.user).error(function(n){e.error=n}).then(function(){window.location="http://localhost:3000/user/#/home"})},e.logIn=function(){n.logIn(e.user).error(function(n){e.error=n}).then(function(){window.location="http://localhost:3000/user/#/home"})},e.isLoggedIn=n.isLoggedIn,e.currentUser=n.currentUser,e.logOut=n.logOut}]),app.factory("auth",["$http","$window",function(e,n){var o={};return o.saveToken=function(e){n.localStorage["flapper-news-token"]=e},o.getToken=function(){return n.localStorage["flapper-news-token"]},o.isLoggedIn=function(){var e=o.getToken();if(e){var t=JSON.parse(n.atob(e.split(".")[1]));return t.exp>Date.now()/1e3}return!1},o.currentUser=function(){if(o.isLoggedIn()){var e=o.getToken(),t=JSON.parse(n.atob(e.split(".")[1]));return t.username}},o.register=function(n){return e.post("/register",n).success(function(e){o.saveToken(e.token)})},o.logIn=function(n){return e.post("/login",n).success(function(e){o.saveToken(e.token)})},o.logOut=function(){n.localStorage.removeItem("flapper-news-token")},o}]);