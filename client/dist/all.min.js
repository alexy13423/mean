var app=angular.module("mainApp",["templates"]);app.controller("MainCtrl",["$scope","auth","$location",function(n,o,e){n.user={},n.register=function(){o.register(n.user).error(function(o){n.error=o}).then(function(){window.location="http://localhost:3000/user/#/home"})},n.logIn=function(){o.logIn(n.login).error(function(o){n.error=o}).then(function(){window.location="http://localhost:3000/user/#/home"})},n.isLoggedIn=o.isLoggedIn,n.currentUser=o.currentUser,n.logOut=o.logOut}]),app.factory("auth",["$http","$window",function(n,o){var e={};return e.saveToken=function(n){o.localStorage["admin-token"]=n},e.getToken=function(){return o.localStorage["admin-token"]},e.isLoggedIn=function(){var n=e.getToken();if(n){var t=JSON.parse(o.atob(n.split(".")[1]));return t.exp>Date.now()/1e3}return!1},e.currentUser=function(){if(e.isLoggedIn()){var n=e.getToken(),t=JSON.parse(o.atob(n.split(".")[1]));return t.username}},e.register=function(o){return n.post("/api/register",o).success(function(n){e.saveToken(n.token)})},e.logIn=function(o){return n.post("/api/login",o).success(function(n){e.saveToken(n.token)})},e.logOut=function(){o.localStorage.removeItem("admin-token")},e}]);