var app=angular.module("mainApp",["ui.router","templates","uiGmapgoogle-maps"]);app.config(["$stateProvider","$urlRouterProvider","uiGmapGoogleMapApiProvider",function(e,t,r){e.state("emailVerify",{url:"/emailverify/:username/:user_token",templateUrl:"emailVerify.html",resolve:{verifyPromise:["$stateParams","verification",function(e,t){return t.emailVerify(e.username,e.user_token)}]},controller:"MainCtrl"}).state("resetPassword",{url:"/resetpassword/:username/:user_token",templateUrl:"resetPassword.html",resolve:{resetPromise:["$stateParams","verification",function(e,t){return t.getUser(e.username,e.user_token)}]},controller:"ResetCtrl"}).state("search",{url:"/search",templateUrl:"search.html",controller:"SearchCtrl",resolve:{searchPromise:["$stateParams","search",function(e,t){return t.get(e.query)}]}}).state("searchResults",{url:"/search/:query",templateUrl:"search.html",controller:"SearchCtrl",resolve:{searchPromise:["$stateParams","search",function(e,t){return t.get(e.query)}]}}).state("mapResults",{url:"/mapResults",templateUrl:"map.html",controller:"MapCtrl",config:r.configure({key:"AIzaSyDHlTfALoPx_zwBB15W1obqHcrtXk8ObVA",v:"3.17",libraries:"places"})}).state("userProfile",{url:"/user/:handle",templateUrl:"userProfile.html",controller:"UserCtrl",resolve:{userPromise:["$stateParams","users",function(e,t){return t.get(e.handle)}]}}).state("item",{url:"/item/:item",templateUrl:"item.html",controller:"ItemCtrl",resolve:{itemPromise:["$stateParams","items",function(e,t){return t.get(e.item)}]}}),t.otherwise("home")}]),app.controller("MainCtrl",["$scope",function(e){}]),app.controller("ResetCtrl",["$scope","$state","verification",function(e,t,r){e.submitPassword=function(){e.user.username=t.params.username,e.user.user_token=t.params.user_token,r.updatePassword(e.user).success(function(){console.log("Redirecting to user app"),window.location="/"}).error(function(t){e.error=t})}}]),app.controller("SearchCtrl",["$scope","search","searchPromise",function(e,t,r){e.users=r.data,console.log(r),e.submitSearch=function(r){console.log(e.search),t.get(e.search),e.users.push(r)}}]),app.controller("MapCtrl",["$scope",function(e){var t={},r=(new google.maps.Map(document.getElementById("map_canvas"),t),{places_changed:function(e){}});e.map={center:{latitude:45,longitude:-99},zoom:8,options:{scrollwheel:!1},searchbox:{template:"searchbox.tpl.html",events:r}}}]),app.controller("UserCtrl",["$scope","users","$stateParams","userPromise","auth",function(e,t,r,o,s){e.user=o.data,console.log(o),e.followUser=function(){t.addFollower(r.handle)},e.isLoggedIn=s.isLoggedIn,e.isFollowing=s.isFollowing}]),app.controller("ItemCtrl",["$scope","items","$stateParams","itemPromise","auth",function(e,t,r,o,s){e.item=o.data}]),app.factory("verification",["$http","$window",function(e,t){return{getUser:function(t,r){return e.get("/api/resetpassword/"+t+"/"+r).success(function(e){return e})},emailVerify:function(t,r){return e.put("/api/emailverify/"+t+"/"+r).success(function(e){console.log(e.message)})},updatePassword:function(t){return e.put("/api/resetpassword/"+t.username+"/"+t.user_token,t).success(function(e){console.log("Success!")})}}}]),app.factory("users",["$http","$window",function(e,t){var r={users:[]};return r.get=function(t){return e.get("/api/user/handle/"+t).success(function(e){return e})},r.addFollower=function(t,r){return e.post("/api/user/"+t+"/followers",r).success(function(e){return e})},r}]),app.factory("items",["$http","$window",function(e,t){var r={items:[]};r.get=function(t){return e.get("/api/item"+t).success(function(e){return e})}}]),app.factory("auth",["$http","$window",function(e,t){var r={};return r.saveToken=function(e){t.localStorage["admin-token"]=e},r.getToken=function(){return t.localStorage["admin-token"]},r.isLoggedIn=function(){var e=r.getToken();if(e){var o=JSON.parse(t.atob(e.split(".")[1]));return o.exp>Date.now()/1e3}return!1},r.currentUser=function(){if(r.isLoggedIn()){var e=r.getToken(),o=JSON.parse(t.atob(e.split(".")[1]));return o.username}},r.logOut=function(){t.localStorage.removeItem("admin-token"),t.location="http://localhost:3000"},r.getUser=function(){if(r.isLoggedIn()){var e=r.getToken(),o=JSON.parse(t.atob(e.split(".")[1]));return o}},r}]);