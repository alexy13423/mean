var app=angular.module("mainApp",["ui.router","templates"]);app.config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("home",{url:"/home",templateUrl:"home.html",controller:"MainCtrl",resolve:{usersPromise:["users",function(t){return t.getAll()}]}}).state("orders",{url:"/orders",templateUrl:"orders.html",controller:"MainCtrl"}).state("user",{url:"/user/:id",templateUrl:"users.html",controller:"UserCtrl",resolve:{userPromise:["$stateParams","users",function(t,e){return e.get(t.id)}]}}),e.otherwise("home")}]),app.controller("MainCtrl",["$scope","users","auth",function(t,e,r){t.isLoggedIn=r.isLoggedIn,t.users=e.users}]),app.controller("UserCtrl",["$scope","users","auth","userPromise",function(t,e,r,n){t.user=n.data,t.update=function(){console.log(t.user),e.update(t.user),mixpanel.identify(t.user._id),mixpanel.track("Settings: Update User")}}]),app.controller("NavCtrl",["$scope","auth",function(t,e){t.isLoggedIn=e.isLoggedIn,t.currentUser=e.currentUser,t.logOut=e.logOut}]),app.factory("posts",["$http","auth",function(t,e){var r={posts:[]};return r.getAll=function(){return t.get("/api/posts").success(function(t){angular.copy(t,r.posts)})},r.create=function(n){return t.post("/api/posts",n,{headers:{Authorization:"Bearer "+e.getToken()}}).success(function(t){r.posts.push(t)})},r.upvote=function(r){return t.put("/api/posts/"+r._id+"/upvote",null,{headers:{Authorization:"Bearer "+e.getToken()}}).success(function(t){r.upvotes+=1})},r.get=function(e){return t.get("/api/posts/"+e).then(function(t){return t.data})},r.addComment=function(r,n){return t.post("/api/posts/"+r+"/comments",n,{headers:{Authorization:"Bearer "+e.getToken()}})},r.upvoteComment=function(r,n){return t.put("/api/posts/"+r._id+"/comments/"+n._id+"/upvote",null,{headers:{Authorization:"Bearer "+e.getToken()}}).success(function(t){n.upvotes+=1})},r}]),app.factory("auth",["$http","$window",function(t,e){var r={};return r.saveToken=function(t){e.localStorage["admin-token"]=t},r.getToken=function(){return e.localStorage["admin-token"]},r.isLoggedIn=function(){var t=r.getToken();if(t){var n=JSON.parse(e.atob(t.split(".")[1]));return n.exp>Date.now()/1e3}return!1},r.currentUser=function(){if(r.isLoggedIn()){var t=r.getToken(),n=JSON.parse(e.atob(t.split(".")[1]));return n.username}},r.logOut=function(){e.localStorage.removeItem("admin-token"),e.location="http://localhost:3000/"},r}]),app.factory("users",["$http","$window","auth",function(t,e,r){var n={users:[]};return n.getAll=function(){return t.get("/api/users").success(function(t){angular.copy(t,n.users)})},n.get=function(e){return t.get("/api/user/"+e).success(function(t){return console.log(t),t})},n.update=function(e){return console.log("updating user",e),t.put("/api/settings",e).success(function(t){n.users=t})},n}]),app.factory("settings",["$http","$window",function(t,e){var r={settings:{}};return r.getAll=function(){return t.get("/api/settings").success(function(t){angular.copy(t,r.settings)})},r}]);