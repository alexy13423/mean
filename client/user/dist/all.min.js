var app=angular.module("mainApp",["ui.router","templates","ngImgCrop","flow"]);app.config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("home",{url:"/home",templateUrl:"home.html",controller:"MainCtrl",resolve:{postPromise:["posts",function(t){return t.getAll()}]}}).state("posts",{url:"/posts/{id}",templateUrl:"posts.html",controller:"PostsCtrl",resolve:{post:["$stateParams","posts",function(t,e){return e.get(t.id)}]}}).state("items",{url:"/items/{id}",templateUrl:"items.html",controller:"ItemsCtrl",resolve:{item:["$stateParams","items",function(t,e){return e.get(t.id)}]}}).state("shop",{url:"/shop",templateUrl:"shop.html",controller:"MainCtrl",resolve:{itemPromise:["items",function(t){return t.getAll()}]}}).state("settings",{url:"/settings",templateUrl:"settings.html",controller:"SettingsCtrl"})}]),app.controller("MainCtrl",["$scope","posts","items","auth",function(t,e,n,o){t.posts=e.posts,t.addPost=function(){t.title&&""!==t.title&&(e.create({title:t.title,link:t.link}),t.title="",t.link="")},t.incrementUpvotes=function(t){e.upvote(t)},t.items=n.items,t.addItem=function(){t.title&&""!==t.title&&(item.create({name:t.title,link:t.link}),t.title="",t.link="")},t.isLoggedIn=o.isLoggedIn}]),app.controller("PostsCtrl",["$scope","posts","post","auth",function(t,e,n,o){t.posts=e.posts,t.post=n,t.addComment=function(){""!==t.body&&(e.addComment(n._id,{body:t.body,author:"user"}).success(function(e){t.post.comments.push(e)}),t.body="")},t.incrementUpvotes=function(t){e.upvoteComment(n,t)}}]),app.controller("ItemsCtrl",["$scope","items","item","auth",function(t,e,n,o){t.items=e.items,t.item=n,t.incrementUpvotes=function(t){e.upvoteItem(n)}}]),app.controller("NavCtrl",["$scope","auth","$location",function(t,e){t.isLoggedIn=e.isLoggedIn,t.currentUser=e.currentUser,t.logOut=e.logOut}]),app.controller("SettingsCtrl",["$scope","languages","settings",function(t,e,n){t.myImage="",t.myCroppedImage="";var o=function(e){var n=e.currentTarget.files[0],o=new FileReader;o.onload=function(e){t.$apply(function(t){t.myImage=e.target.result})},o.readAsDataURL(n)};angular.element(document.querySelector("#fileInput")).on("change",o),t.addLanguage=function(){e.test(t.language.name),e.addLang(t.language.name)},t.updateSettings=function(){n.update(t.setting)}}]),app.factory("posts",["$http","auth",function(t,e){var n={posts:[]};return n.getAll=function(){return t.get("/api/posts").success(function(t){angular.copy(t,n.posts)})},n.create=function(o){return t.post("/api/posts",o,{headers:{Authorization:"Bearer "+e.getToken()}}).success(function(t){n.posts.push(t)})},n.upvote=function(n){return t.put("/api/posts/"+n._id+"/upvote",null,{headers:{Authorization:"Bearer "+e.getToken()}}).success(function(t){n.upvotes+=1})},n.get=function(e){return t.get("/api/posts/"+e).then(function(t){return t.data})},n.addComment=function(n,o){return t.post("/api/posts/"+n+"/comments",o,{headers:{Authorization:"Bearer "+e.getToken()}})},n.upvoteComment=function(n,o){return t.put("/api/posts/"+n._id+"/comments/"+o._id+"/upvote",null,{headers:{Authorization:"Bearer "+e.getToken()}}).success(function(t){o.upvotes+=1})},n}]),app.factory("items",["$http","auth",function(t,e){var n={items:[]};return n.getAll=function(){return t.get("/api/items").success(function(t){angular.copy(t,n.items)})},n.create=function(o){return t.post("/api/items",post,{headers:{Authorization:"Bearer "+e.getToken()}}).success(function(t){n.items.push(t)})},n.upvote=function(n){return t.put("/api/items/"+n._id+"/upvote",null,{headers:{Authorization:"Bearer "+e.getToken()}}).success(function(t){n.upvotes+=1})},n.get=function(e){return t.get("/api/items/"+e).then(function(t){return t.data})},n}]),app.factory("auth",["$http","$window",function(t,e){var n={};return n.saveToken=function(t){e.localStorage["admin-token"]=t},n.getToken=function(){return e.localStorage["admin-token"]},n.isLoggedIn=function(){var t=n.getToken();if(t){var o=JSON.parse(e.atob(t.split(".")[1]));return o.exp>Date.now()/1e3}return!1},n.currentUser=function(){if(n.isLoggedIn()){var t=n.getToken(),o=JSON.parse(e.atob(t.split(".")[1]));return o.username}},n.logOut=function(){e.localStorage.removeItem("admin-token"),e.location="http://localhost:3000"},n}]),app.factory("languages",["$http","$window",function(t,e){var n={languages:[]};return n.test=function(t){console.log(t)},n.getLangs=function(e){return t.get("/api/settings/lanuages").success(function(t){angular.copy(t,n.items)})},n.addLang=function(e){return t.post("/api/settings/languages").success(function(t){n.languages.push(t)})},n}]),app.factory("settings",["$http","$window",function(t,e){var n={settings:[]};return n.test=function(t){console.log(t)},n.getSettings=function(){return t.get("/api/settings/",{headers:{Authorization:"Bearer "+auth.getToken()}}).success(function(t){angular.copy(t,n.items)})},n.update=function(){return t.put("/api/settings/").success(function(t){n.settings.push(t)})},n}]);