var app=angular.module("mainApp",["ui.router","templates","ngImgCrop","flow"]);app.config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("home",{url:"/home",templateUrl:"home.html",controller:"MainCtrl",resolve:{postPromise:["posts",function(t){return t.getAll()}]}}).state("posts",{url:"/posts/:post",templateUrl:"posts.html",controller:"PostsCtrl",resolve:{post:["$stateParams","posts",function(t,e){return e.get(t.id)}]}}).state("shop",{url:"/shop",templateUrl:"shop.html",controller:"ShopCtrl",resolve:{itemPromise:["items",function(t){return t.getAll()}]}}).state("items",{url:"/items/:item",templateUrl:"items.html",controller:"ItemsCtrl",resolve:{item:["$stateParams","items",function(t,e){return e.get(t.id)}]}}).state("transactions",{url:"/transactions",templateUrl:"transactions.html",controller:"TransCtrl",resolve:{item:["$stateParams","items",function(t,e){return e.get(t.id)}]}}).state("checkout",{url:"/checkout",templateUrl:"checkout.html",controller:"CheckoutCtrl",resolve:{item:["$stateParams","items",function(t,e){return e.get(t.id)}]}}).state("groups",{url:"/groups",templateUrl:"groups.html",controller:"GroupsCtrl",resolve:{groupPromise:["groups",function(t){return t.getAll()}]}}).state("/group_home",{url:"/group_home/:group",templateUrl:"group_home.html",controller:"GHomeCtrl",resolve:{gpostPromise:["gposts",function(t){return t.getAll()}]}}).state("/gposts",{url:"/gposts/:gpost",templateUrl:"gposts.html",controller:"GpostCtrl",resolve:{gcommentPromise:["gcomments",function(t){return t.getAll()}]}}).state("settings",{url:"/settings",templateUrl:"settings.html",controller:"SettingsCtrl"})}]),app.controller("MainCtrl",["$scope","posts","auth",function(t,e,o){t.posts=e.posts,t.addPost=function(){t.title&&""!==t.title&&(e.create({title:t.title,link:t.link}),t.title="",t.link="")},t.incrementUpvotes=function(t){e.upvote(t)},t.isLoggedIn=o.isLoggedIn}]),app.controller("PostsCtrl",["$scope","$stateParams","posts","comments","auth",function(t,e,o,n,s){var r=o.post[e.id];t.post._id=$routeParams.postId,t.post=o.post,t.comments=n.comments,t.addComment=function(){scope.body&&""!==t.body&&(o.addComment(o.post._id,{body:t.body,author:"user"}).success(function(e){t.post.comments.push(e)}),t.body="")},t.incrementUpvotes=function(t){o.upvoteComment(r,t)},t.isLoggedIn=s.isLoggedIn}]),app.controller("ShopCtrl",["$scope","items","auth",function(t,e,o){t.items=e.items,t.addItem=function(){""!==t.name&&(e.create({name:t.name}),t.name="")},t.incrementUpvotes=function(t){e.upvoteItem(t)},t.isLoggedIn=o.isLoggedIn}]),app.controller("ItemsCtrl",["$scope","items","item","auth",function(t,e,o,n){t.items=e.items,t.item=o,t.incrementUpvotes=function(t){e.upvoteItem(t)},t.isLoggedIn=n.isLoggedIn}]),app.controller("NavCtrl",["$scope","auth","$location",function(t,e){t.isLoggedIn=e.isLoggedIn,t.home=e.isLoggedIn,t.currentUser=e.currentUser,t.logOut=e.logOut}]),app.controller("TransCtrl",["$scope","items","item","auth",function(t,e,o,n){t.items=e.items,t.item=o,t.isLoggedIn=n.isLoggedIn}]),app.controller("SettingsCtrl",["$scope","languages","settings",function(t,e,o){t.myImage="",t.myCroppedImage="";var n=function(e){var o=e.currentTarget.files[0],n=new FileReader;n.onload=function(e){t.$apply(function(t){t.myImage=e.target.result})},n.readAsDataURL(o)};angular.element(document.querySelector("#fileInput")).on("change",n),t.addLanguage=function(){e.test(t.language.name),e.addLang(t.language.name)},t.updateSettings=function(){o.update(t.setting)}}]),app.controller("GroupsCtrl",["$scope","groups","auth",function(t,e,o){t.groups=e.groups,t.addGroup=function(){t.name&&""!==t.name&&(e.create({name:t.name}),t.name="")},t.isLoggedIn=o.isLoggedIn}]),app.controller("GhomeCtrl",["$scope","$stateParams","gposts","auth",function(t,e,o,n){var s=o.gpost[e.id];t.get(s._id),t.gpost=o.gpost,t.addGroupPost=function(){scope.body&&""!==t.body&&(groups.addGpost(groups.group._id,{body:t.body,author:"user"}).success(function(e){t.group.gpost.push(e)}),t.body="")},t.incrementUpvotes=function(t){o.upvoteGroupPost(t)},t.isLoggedIn=n.isLoggedIn}]),app.controller("GpostCtrl",["$scope","$stateParams","gposts","gcomments","auth",function(t,e,o,n,s){var r=o.gpost[e.id];t.get(r._id),t.gpost=o.gpost,t.gcomments=n.gcomments,t.addGroupComment=function(){scope.body&&""!==t.body&&(o.addGroupComment(o.gpost._id,{body:t.body,author:"user"}).success(function(e){t.gpost.gcomments.push(e)}),t.body="")},t.incrementUpvotes=function(t){o.upvoteGroupComment(r,t)},t.isLoggedIn=s.isLoggedIn}]),app.factory("posts",["$http","auth",function(t,e){var o={posts:[],post:{}};return o.getAll=function(){return t.get("/api/posts").success(function(t){angular.copy(t,o.posts)})},o.create=function(n){return t.post("/api/posts",n,{headers:{Authorization:"Bearer "+e.getToken()}}).success(function(t){o.posts.push(t)})},o.upvote=function(o){return t.put("/api/posts/"+o._id+"/upvote",null,{headers:{Authorization:"Bearer "+e.getToken()}}).success(function(t){o.upvotes+=1})},o.get=function(e){return t.get("/api/posts/"+e).then(function(t){return t.data})},o.addComment=function(o,n){return t.post("/api/posts/"+o+"/comments",n,{headers:{Authorization:"Bearer "+e.getToken()}})},o.upvoteComment=function(o,n){return t.put("/api/posts/"+o._id+"/comments/"+n._id+"/upvote",null,{headers:{Authorization:"Bearer "+e.getToken()}}).success(function(t){n.upvotes+=1})},o}]),app.factory("comments",["$http","auth",function(t,e){var o={comments:[]};return o.getAll=function(){return t.get("/api/comments").success(function(t){angular.copy(t,o.comments)})},o}]),app.factory("items",["$http","auth",function(t,e){var o={items:[],item:{}};return o.getAll=function(){return t.get("/api/items").success(function(t){angular.copy(t,o.items)})},o.create=function(n){return t.post("/api/items",n,{headers:{Authorization:"Bearer "+e.getToken()}}).success(function(t){o.items.push(t)})},o.get=function(e){return t.get("/api/items/"+e).then(function(t){return t.data})},o.upvote=function(o){return t.put("/api/items/"+o._id+"/upvote",null,{headers:{Authorization:"Bearer "+e.getToken()}}).success(function(t){o.upvotes+=1})},o.addTransaction=function(e,o){return t.post("/api/items/"+e+"/transactions",o,{headers:{Authorization:"Bearer "+transactions.getToken()}}).success(function(t){transactions.push(t)})},o}]),app.factory("transactions",["$http","auth",function(t,e){var o={transactions:[]};return o.get=function(e){return t.get("/api/transactions/"+e).then(function(t){return t.data})},o.addCustomer=function(e,o){return t.post("api/transactions"+e+"/customers",o,{headers:{Authorization:"Bearer "+transactions.getToken()}}).success(function(t){transactions.push(t)})},o}]),app.factory("customers",["$http","auth",function(t,e){var o={customers:[]};return o.get=function(e){return t.get("/api/customers/"+e).then(function(t){return t.data})},o}]),app.factory("auth",["$http","$window",function(t,e){var o={};return o.saveToken=function(t){e.localStorage["admin-token"]=t},o.getToken=function(){return e.localStorage["admin-token"]},o.isLoggedIn=function(){var t=o.getToken();if(t){var n=JSON.parse(e.atob(t.split(".")[1]));return n.exp>Date.now()/1e3}return!1},o.currentUser=function(){if(o.isLoggedIn()){var t=o.getToken(),n=JSON.parse(e.atob(t.split(".")[1]));return n.username}},o.logOut=function(){e.localStorage.removeItem("admin-token"),e.location="http://localhost:3000"},o}]),app.factory("languages",["$http","$window",function(t,e){var o={languages:[]};return o.test=function(t){console.log(t)},o.getLangs=function(e){return t.get("/api/settings/lanuages").success(function(t){angular.copy(t,o.items)})},o.addLang=function(e){return t.post("/api/settings/languages").success(function(t){o.languages.push(t)})},o}]),app.factory("settings",["$http","$window",function(t,e){var o={settings:[]};return o.test=function(t){console.log(t)},o.getSettings=function(){return t.get("/api/settings/",{headers:{Authorization:"Bearer "+auth.getToken()}}).success(function(t){angular.copy(t,o.items)})},o.update=function(){return t.put("/api/settings/").success(function(t){o.settings.push(t)})},o}]),app.factory("groups",["$http","auth",function(t,e){var o={groups:[],group:{}};return o.getAll=function(){return t.get("/api/groups").success(function(t){angular.copy(t,o.groups)})},o.create=function(n){return t.post("/api/groups",n,{headers:{Authorization:"Bearer "+e.getToken()}}).success(function(t){o.groups.push(t)})},o.get=function(e){return t.get("/api/groups/"+e).then(function(t){return t.data})},o}]),app.factory("gposts",["$http","auth",function(t,e){var o={gposts:[],gpost:{}};return o.getAll=function(){return t.get("/api/gposts").success(function(t){angular.copy(t,o.gposts)})},o.create=function(n){return t.post("/api/gposts",n,{headers:{Authorization:"Bearer "+e.getToken()}}).success(function(t){o.gposts.push(t)})},o.upvote=function(o){return t.put("/api/gposts/"+post._id+"/upvote",null,{headers:{Authorization:"Bearer "+e.getToken()}}).success(function(t){o.upvotes+=1})},o.get=function(e){return t.get("/api/gposts/"+e).then(function(t){return t.data})},o.addGroupComment=function(o,n){return t.post("/api/gposts/"+o+"/gcomments",n,{headers:{Authorization:"Bearer "+e.getToken()}})},o}]),app.factory("gcomments",["$http","auth",function(t,e){var o={gcomments:[]};return o.getAll=function(){return t.get("/api/gcomments").success(function(t){angular.copy(t,o.gcomments)})},o}]);